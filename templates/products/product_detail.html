{% extends 'shop/base.html' %}

{% block content %}
{% load static %}

<div class='row'>
    <div calss='col-12 col-md-6'>
        {% include 'products/snippets/update-cart.html' with product=product cart=cart %}
    </div>
</div>

<div class='container' style="padding-top:20px;">
    <div class='row'>
        <!-- 사진부분 -->
        <div class='col-lg-7 col-md-10 col-sm-12 mx-auto'style="padding-bottom:20px;">
            <div>
                <div class='row'>
                    <div class='col-12'>
                        <picture>
                            <img class="detail-image detail-image-main" src="{{ product.image.url }}" alt="메인사진" style="width:90%;height:90%;float:both;">
                        </picture>
                    </div>
                </div>
            </div>
        </div>
        <!-- 설명부분 div1 -->
        <div class='col-lg-5 col-md-12 col-sm-12 ml-auto'> 
            <div style="width:100%;height:100%;">
                <div class="product-detail-head">
                    <span class="product-detail-number">{{ product.number }}</span>
                </div>
                <div class="product-detail-main">
                    <h1 class="product-detail-product-name">{{ product.title }}</h1>
                    <span class="product-detail-brand">{{ product.brand|upper }}</span>
                </div>
                <div>
                    <span style="font-size:large;">경매 현재가격 : </span>
                    <span style="font-size:large;">₩ {{ product.current_price }}</span>
                    <span style='color:gray;'><del>₩ {{ product.list_price }}</del></span>
                    <span style=>{{ product.sale_ratio|floatformat }}%</del></span>
                </div>
                <div>
                    <span style="font-size:large;">상시 판매가격 : </span>
                    <span style="font-size:large;">₩ {{ product.limit_price }}</span>
                    <span style='color:gray;'><del>₩ {{ product.list_price }}</del></span>
                </div>
                <div>
                    <p class='lead'>원산지 : {{ product.made_info_made_country }}</p>
                    <p class='lead'>모델명 : {{ product.info_product_number }}</p>
                    <p class='lead'>배송정보 : {{ product.info_delivery }}</p>
                    <p class='lead'>국내·해외배송 : {{ product.info_delivery_from }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 경매 참여 현황 -->
    <div class='row'>
        <h3>-경매 현황-</h3>
        <div class='col-lg-12 col-md-12 col-sm-12 mx-auto'> 
            {% if bidding_obj_up_to_10 %}
            <div class='row'>
                <div class='col-12'>
                    <table class="table text-center">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">ID</th>
                            <th scope="col">경매 참가액</th>
                            <th scope="col">경매 참여시간</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for bidding in bidding_obj_up_to_10 %}
                        <tr>
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{ bidding.user|upper|slice:":2" }}*****</td>
                            <td>{{ bidding.bidding_price }} 원</td>
                            <td>{{ bidding.timestamp }}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% else %}
            <div class='row'>
                <div class='col-12'>
                    <table class="table text-center">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">ID</th>
                            <th scope="col">경매 참가액</th>
                            <th scope="col">경매 참여시간</th>
                        </tr>
                        </thead>
                    </table>
                    <div class='text-center'>
                        <h3>No One Bidding...</h3>
                    </div>
                    
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- 경매 참여버튼 -->
    <!-- 경매 시작전 버튼설정 -->
    {% if bidding_on == '1' %}
    <div class='row'>
        <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
            <button type="button" class="btn btn-secondary btn-block" style="margin-top:20px;">경매 준비 중</button></a>
        </div>
    </div>
    <!-- 경매 중 버튼설정 -->
    {% elif bidding_on == '2' %}
    <div class='row'>
        <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
            <a href="{% url 'products:bidding_new' slug=product.slug %}"><button type="button" class="btn btn-primary btn-block" style="margin-top:20px;">경매 참여</button></a>
        </div>

        {% if is_stock %}
            {% if buy_activate %}
            <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
                <form method="post" action="{% url 'carts:update' %}">
                    {% csrf_token %}
                    <input id="product" type="hidden" name="product_id" value="{{ product.id }}">
                    <input id="product" type="hidden" name="location" value="detail_page">
                    <button type="submit" class="btn btn-block btn-success" style="margin-top:20px;">상시상품 구매</button>
                </form>
            </div>
            {% else %}
            <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
                <button type="button" class="btn btn-secondary btn-block" style="margin-top:20px;">상시상품 구매불가</button></a>
            </div>
            {% endif %}  
        {% else %}
        <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
            <button type="button" class="btn btn-secondary btn-block" style="margin-top:20px;">상시상품 재고없음</button></a>
        </div>
        {% endif %}
    </div>
    <!-- 경매 종료후 버튼설정 -->
    {% elif bidding_on == '3' %}
    <div class='row'>
        <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
            <a href="{% url 'products:bidding_result' slug=product.slug %}"><button type="button" class="btn btn-success btn-block" style="margin-top:20px;">경매 결과확인</button></a>
        </div>
        {% if is_stock %}
            {% if buy_activate %}
            <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
                <form method="post" action="{% url 'carts:update' %}">
                    {% csrf_token %}
                    <input id="product" type="hidden" name="product_id" value="{{ product.id }}">
                    <input id="product" type="hidden" name="location" value="detail_page">
                    <button type="submit" class="btn btn-block btn-success" style="margin-top:20px;">상시상품 구매</button>
                </form>
            </div>
            {% else %}
            <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
                <button type="button" class="btn btn-secondary btn-block" style="margin-top:20px;">상시상품 구매불가</button></a>
            </div>
            {% endif %}    
        {% else %}
        <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
            <button type="button" class="btn btn-secondary btn-block" style="margin-top:20px;">상시상품 재고없음</button></a>
        </div>
        {% endif %}
    </div>
    <!-- 버튼관련 에러있을 때. -->
    {% else %}
    <div class='row'>
        <div class='col-lg-6 col-md-6 col-sm-12 mx-auto'>
            <h3>Bidding 시간 혹은 현재가격이상.</h3>
        </div>
    </div>
    {% endif %}

    <!-- 경매 정보 -->
    <div class='row'> 
        <div class="col-lg-6 col-md-12 col-sm-12 ml-auto product-detail-bidding">
            <p class="product-detail-bidding-header" style="font-weight:bold;font-size:0.8rem;">-경매 정보 1-</p>
            <table class="table table-striped table-bidding-info text-center">
                <thead>
                    <th scope="col">경매 현재가격</th>
                    <th scope="col">경매 시작가격</th>
                    <th scope="col">경매 종료가격<br>(상시판매가격)</th>
                    <th scope="col">경매 남은시간</th>
                </thead>
                <tbody>
                    <tr>
                        <td class="table-bidding-info" style="font-weight:bold;color:red;">₩ {{ product.current_price }}</td>
                        <td class="table-bidding-info">₩ {{ product.start_price }}</td>
                        <td class="table-bidding-info">₩ {{ product.limit_price }}</td> 
                        <td class="table-bidding-info" style="font-weight:bold;color:red;">{{ product.remain_bidding_time }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-lg-6 col-md-12 col-sm-12 mr-auto product-detail-bidding-info">
            <p class="product-detail-bidding-header" style="font-weight:bold;font-size:0.8rem;">-경매 정보2-</p>
            <table class="table table-striped table-bidding-info text-center">
                <thead>
                    <th scope="col">경매시작 일정</th>
                    <th scope="col">경매종료 일정</th>
                    <th scope="col">경매금액 단위</th>
                    <th scope="col">경매물품 수량</th>
                    <th scope="col">상시상품 수량</th>
                    
                </thead>
                <tbody>
                    <tr>
                        <td class="table-bidding-info">{{ product.bidding_start_date|date:"SHORT_DATE_FORMAT" }}{{ product.bidding_start_date|time:"H:i" }}</td>
                        <td class="table-bidding-info">{{ product.bidding_end_date|date:"SHORT_DATE_FORMAT" }}{{ product.bidding_end_date|time:"H:i" }}</td>
                        <td class="table-bidding-info">₩1,000</td>
                        <td class="table-bidding-info">{{ product.amount }}EA</td>
                        <td class="table-bidding-info">{{ product.amount_always_on }}EA</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class='row'>
        <div class="product-detail-description">
            <p class="product-detail-description-header"  style="font-weight:bold;font-size:0.8rem;margin-bottom:8px;">-PRODUCT INFO-</p>
            <ul style="">
                <li>{{ product.description|linebreaks }}</li>
            </ul>
        </div>
    </div>    
 
    <div class="row">
        <div class='col-lg col-md col-sm-12'>
            <div class="detail-image-header">
                <p class="detail-image-header-text">-Detail View-</p>
            </div>
            <!-- 그림부분 맨 처음은 메인이미지. 그다음은 forloop로 돌리는 서브 데테일 이미지들-->
            <div class='col-8 mx-auto' style="padding:0px;">
                <picture>
                    <img class="detail-image detail-image-sub" src="{{ product.image.url }}" alt="메인사진" style="width:100%;height:100%;float:both;">
                </picture>
            </div>
            {% for image in images %}
            <div class='col-8 mx-auto' style="padding:0px;">
                <picture>
                    <img class="detail-image detail-image-sub" src="{{ image.image.url }}" alt="서브사진{{ forloop.counter }}" style="width:100%;height:100%;float:both;">
                </picture>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}
{% url 'carts:home' as cart_url %}


{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
    <!-- meta og properties -->
    
    <meta property="og:title" content='MOUM8'>
    <meta property="og:image" content="{% static 'shop/meta_header_image.jpg' %}"> 
    <meta property="og:image:width" content="800"/>
    <meta property="og:image:height" content="400"/> 
    <meta property="og:url" content="https://moum8.com/"/> 
    <meta property="og:site_name" content="MOUM8"/> 
    <meta property="og:type" content="website"/>
    <meta property="og:description" content="명품 쇼핑몰 MOUM8 입니다.">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    
    <!-- fontawsome CSS -->
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
        

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    

    <!-- CSRF for ajax JS -->
    <script src="{% static 'js/csrf.ajax.js' %}"></script>

      <!-- js render -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrender/1.0.11/jsrender.js"></script>
    <!-- % include 'shop/base/js_template.html' %} -->
    
    <!-- ecommerce Custom2 js -->
    <script src="{% static 'js/ecommerce.billing.js' %}"></script>  

    <!-- iamport.payment.js -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
    
    <!-- Jquery-confirm JavaScript -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script> -->
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> -->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">

    <!-- Shop Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/shop.css' %}">


    {% block header %}
    {% endblock %}
    <style>
      .add-border{
          border-top:1px solid rgb(238, 238, 238);
          border-bottom:2px solid rgb(238, 238, 238);
          border-left:1px solid rgb(238, 238, 238);
          border-right:2px solid rgb(238, 238, 238);
      }
      
      .sidenav-home {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 4;
        top: 40px;
        right: 0;
        background-color: #423f3b;
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 60px;
      }
      
      .sidenav-home a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: medium;;
        color: #cbbeb5;
        display:block;
        transition: 0.3s;
      }
      
      .sidenav-home a:hover {
        color: white;
      }
      
      .sidenav-home .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
      }
      
      @media screen and (max-height: 450px) {
        .sidenav-home {padding-top: 15px;}
        .sidenav-home a {font-size: 18px;}
      }

      .main-sidebar { 
        display: none; 
      }
      
      @media (max-width: 992px) {
          .main-sidebar {
            display:inline;
          }
          .main-sidebar-close { 
            display: none; 
          }
          .navbar-toggler{
            display:none;
          }
      }

      .dropdown-item{
        color: gray!important;
      }
      .dropdown-item a:hover {
        color: black!important;
        background-color: gray;
      }

      .dropdown-item-2{
        color:#cbbeb5!important;
        padding: 0!important;
        padding-bottom:5px!important;
        font-size:15px!important;
        /* padding-right: 0!important;
        padding-right: 0!important;
        padding-right: 0!important; */
        
      }

      .navbar2-expand-lg {
          -webkit-box-orient: horizontal;
          -webkit-box-direction: normal;
          /* -ms-flex-flow: row nowrap; */
          flex-flow: row nowrap;
          -webkit-box-pack: start;
          /* -ms-flex-pack: start; */
          justify-content: flex-start;
      }

      .nav2 a:active {
        background-color:transparent;
        }

      .div-category-fixed:hover {
        border-left:1px solid rgb(224, 224, 224);
        border-right:1px solid rgb(224, 224, 224);
      }
      /* .a-category-fixed {
        font-family:'SeoulNamsanM'!important;
        font-weight:bold!important;

      } */

      </style>
    <title>MOUM8, 시작</title>
  </head> 
  
  <body>
    {% include 'shop/base/navbar.html' %}
  



    {% if messages %}
        <div class="alert alert-success messages">
            {% for message in messages %}
            <span{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}Important: {% endif %}
                {{ message }}<br/>
            </span>
            {% endfor %}
        </div>
    {% endif %}

    {% block content %}
    {% endblock %} 
  
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script> -->

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
    -->
    
    
    <hr style="margin: 10px 0px 0px; height: 1px; border: none; background-color: rgb(224, 224, 224);">
    <!-- 여기부터 Footer -->  
    {% include 'shop/base/footer.html' %}
    <!-- Footer 끝 --> 



    <script>
      $(document).ready(function(){
        // Auto Search
        var searchForm = $(".search-form")
        var searchInput = searchForm.find("[name='q']") // input name='q'
        var typingTimer
        var typingInterval = 500 // 0.5 seconds
        var searchBtn = searchForm.find("[type='submit']")


        searchInput.keyup(function(event){
          // key released
          clearTimeout(typingTimer)
          typingTimer = setTimeout(performSearch, typingInterval)
        })

        searchInput.keydown(function(event){
        // key pressed
          clearTimeout(typingTimer)
        })

        function displaySearch(){
          searchBtn.addClass("disable")
          searchBtn.html("<i class='fa fa-spin fa-spinner'></i> Searching...")
        }


        function performSearch(){
          displaySearch()
          var query = searchInput.val()
          setTimeout(function(){
            window.location.href='/search/?q=' + query
          }, 1000)
          
        }

        // Cart + Add Products
        var productForm = $(".form-product-ajax") // #form-product-ajax

        productForm.submit(function(event){
          event.preventDefault()
          // console.log("Form is not sending")
          var thisForm = $(this)
          // var actionEndpoint = thisForm.attr('action')  // API Endpoint
          var actionEndpoint = thisForm.attr('data-endpoint')  // API Endpoint
          var httpMethod = thisForm.attr('method')
          var formData = thisForm.serialize()

          $.ajax({
            url: actionEndpoint,
            method: httpMethod,
            data: formData,
            success: function(data){
              var submitSpan = thisForm.find(".submit-span")
              if (data.added){
                submitSpan.html("In cart<button type='submit' class='btn btn-link'>Remove?</button>")
              } else {
                submitSpan.html("<button class='btn btn-success'>Add?</button>")
              }
              var navbarCount = $(".navbar-cart-count")
              navbarCount.text(data.cartItemCount)
              var currentPath = window.location.href

              if (currentPath.indexOf("cart") != -1){
                refreshCart()
              }
           },
            error: function(errorData){
              $.alert({
                title: "Oops!",
                content: "An error occurred",
                theme: "modern"
              })
            }

          })
        })

        function refreshCart(){
          console.log("in current cart")
          var cartTable = $(".cart-table")
          var cartBody = cartTable.find(".cart-body")
          //cartBody.html("<h1>Changed<h1>")
            var productRows = cartBody.find(".cart-product")
            var currentUrl = window.location.href

          var refreshCartUrl = '/api/cart/'
          var refreshCartMethod = "GET"
          var data = {}
          $.ajax({
            url: refreshCartUrl,
            method: refreshCartMethod,
            data:data,
            success: function(data){
              var hiddenCartItemRemoveForm = $(".cart-item-remove-form")
              if (data.products.length > 0){
                productRows.html("")
                i = data.products.length
                $.each(data.products, function(index, value){
                  console.log(value)
                  var newCartItemRemove = hiddenCartItemRemoveForm.clone()
                  newCartItemRemove.css("display", "block")
                  newCartItemRemove.find(".cart-item-product-id").val(value.id)
                  cartBody.prepend("<tr><th scope=\"row\">" + i + "</th><td><a href='" + value.url + "'>" + value.name + "</a></td>" + "<td>" + value.price + "</td><td>" + newCartItemRemove.html() + "</td></tr>")
                  i --
                })
                cartBody.find(".cart-subtotal").text(data.subtotal)
                cartBody.find(".cart-total").text(data.total)
                
              } else {
                window.location.href = currentUrl
              }
              
            },
            error: function(errorData){
              $.alert({
                title: "Oops!",
                content: "An error occurred",
                theme: "modern"
              })
            }
          })
        }

      })

    </script>
    <script>
      function openNav() {
        document.getElementById("mySidenav-home").style.width = "200px";
        $("#id_main-sidebar").html('<span style="font-size:medium;cursor:pointer" onclick="closeNav()">&#9776; MENU</span>')
      }
      
      function closeNav() {
        document.getElementById("mySidenav-home").style.width = "0";
        $("#id_main-sidebar").html('<span style="font-size:medium;cursor:pointer" onclick="openNav()">&#9776; MENU</span>')
      }

      </script>
    
  {% block javascript %}
  {% endblock %}
  </body>
</html>